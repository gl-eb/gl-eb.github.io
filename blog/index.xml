<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Gleb Ebert</title>
<link>https://www.gl-eb.me/blog/</link>
<atom:link href="https://www.gl-eb.me/blog/index.xml" rel="self" type="application/rss+xml"/>
<description>This is Gleb Ebert&#39;s personal website. You can learn about me and what I do here.</description>
<generator>quarto-1.9.9</generator>
<lastBuildDate>Sun, 02 Nov 2025 00:00:00 GMT</lastBuildDate>
<item>
  <title>UpSet Plots in the Tidyverse</title>
  <dc:creator>Gleb G. Ebert</dc:creator>
  <link>https://www.gl-eb.me/blog/posts/2025-11-02_upset/</link>
  <description><![CDATA[ 






<section id="upwhat-plot" class="level2">
<h2 class="anchored" data-anchor-id="upwhat-plot">UpWhat Plot?</h2>
<p>Venn diagrams are commonly used to show the sizes of sets and their overlaps in an intuitive way. However, they can quickly become <a href="https://www.nature.com/articles/nature11241#Fig4">overly complicated</a> when comparing more than a few sets. For this reason, the <a href="https://upset.app/">UpSet plot</a> was developed as an alternative to Venn diagrams <span class="citation" data-cites="lexUpSetVisualizationIntersecting2014">(<em>1</em>)</span>. I recently needed to create UpSet plots and looked for implementations in R, of <a href="https://github.com/hms-dbmi/UpSetR">which</a> <a href="https://github.com/const-ae/ggupset">there</a> <a href="https://github.com/gaospecial/ggVennDiagram">are</a> <a href="https://jokergoo.github.io/ComplexHeatmap-reference/book/upset-plot.html">many</a>. Some were outdated but mostly they were not customisable in the ways I wanted them to be<sup>1</sup>. Eventually, I realised that UpSet plots are easily created using just the <a href="https://ggplot2.tidyverse.org/"><code>ggplot2</code></a> and <a href="https://patchwork.data-imaginist.com/"><code>patchwork</code></a> packages. This means you do not have to learn additional packages and can just customise your UpSet plot the way you would any other standard ggplot. Thus, this post is a brief tutorial on how to go from data to an UpSet plot using only tidyverse packages.</p>
</section>
<section id="data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling">Data Wrangling</h2>
<p>First of all, we will load the necessary of packages.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(forcats)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(patchwork)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rlang)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(stringr)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># alternatively, you can just load the tidyverse and patchwork</span></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># library(tidyverse)</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># library(patchwork)</span></span></code></pre></div></div>
</div>
<p>Next, we will get the raw data from the <a href="https://nycflights13.tidyverse.org/"><code>nycflights13</code></a> package and join the <code>flights</code> and <code>planes</code> tables by their tail number (think registration plate). Then we will determine presence and absence of aircraft types at the three airports present in the data set.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import and join tables on flights and aircraft</span></span>
<span id="cb2-2">dat_nycf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(</span>
<span id="cb2-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> nycflights13<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>flights,</span>
<span id="cb2-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> nycflights13<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>planes,</span>
<span id="cb2-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">join_by</span>(tailnum)</span>
<span id="cb2-6">)</span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># only keep data necessary for this analysis</span></span>
<span id="cb2-9">dat_present <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat_nycf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">drop_na</span>(manufacturer, model) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aircraft =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_to_title</span>(manufacturer), model),</span>
<span id="cb2-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aircraft =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace</span>(aircraft, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" Industrie"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb2-14">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"airport"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> origin, aircraft) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">present =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-18"></span>
<span id="cb2-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># expand aircraft–airport combinations to include absence data</span></span>
<span id="cb2-20">dat_absent <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat_present <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand</span>(airport, aircraft) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anti_join</span>(dat_present, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">join_by</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"airport"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"aircraft"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">present =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-24"></span>
<span id="cb2-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># combine tables into presence/absence data</span></span>
<span id="cb2-26">dat_pa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(dat_present, dat_absent)</span>
<span id="cb2-27"></span>
<span id="cb2-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pivot wider</span></span>
<span id="cb2-29">dat_pa_w <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat_pa <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id_cols =</span> aircraft, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> airport, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> present)</span>
<span id="cb2-31">dat_pa_w</span></code></pre></div></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 136 × 4
   aircraft                              EWR   LGA   JFK
   &lt;chr&gt;                               &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 Boeing 737-824                          1     1     0
 2 Boeing 757-223                          1     1     1
 3 Airbus A320-232                         1     1     1
 4 Boeing 757-232                          1     1     1
 5 Boeing 737-924ER                        1     0     0
 6 Canadair CL-600-2B19                    0     1     1
 7 Boeing 757-224                          1     0     1
 8 Mcdonnell Douglas Aircraft Co MD-88     1     1     1
 9 Boeing 737-832                          1     1     1
10 Airbus A319-114                         1     1     1
# ℹ 126 more rows</code></pre>
</div>
</div>
<p>As you can see, a value of <code>1</code> indicates that a particular type was present at an airport and <code>0</code> if it was not. For example, the Boeing 737-824 was seen at the Newark and LaGuardia airports but not at JFK.</p>
<p>Next, we will calculate the size of intersections between airports (i.e.&nbsp;how many aircraft were seen at multiple airports).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vector of airports</span></span>
<span id="cb4-2">airports <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat_present <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(airport) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>()</span>
<span id="cb4-5"></span>
<span id="cb4-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get airport combinations and count the number of aircraft types within them</span></span>
<span id="cb4-7">dat_comb_size <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat_pa_w <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>aircraft), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"size"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb4-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">degree =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all_of</span>(airports)))</span>
<span id="cb4-12">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unite</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> combination, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all_of</span>(airports), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">remove =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(degree), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(size)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">combination =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_inorder</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_factor</span>(combination)))</span>
<span id="cb4-17">dat_comb_size</span></code></pre></div></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 6
  combination   EWR   LGA   JFK  size degree
  &lt;fct&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
1 111             1     1     1    30      3
2 110             1     1     0    41      2
3 101             1     0     1     9      2
4 011             0     1     1     8      2
5 001             0     0     1    22      1
6 100             1     0     0    20      1
7 010             0     1     0     6      1</code></pre>
</div>
</div>
<p>For example, we can see that 41 aircraft types are only seen at Newark and LaGuardia, but not at JKF. Now let us also create a table that shows which airports are contained in each combination.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get table with presence/absence of any airport in a particular combination</span></span>
<span id="cb6-2">dat_comb_w <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat_comb_size <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(combination, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all_of</span>(airports)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>combination, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"set"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"in_comb"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">set =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_inorder</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_factor</span>(set)))</span>
<span id="cb6-6">dat_comb_w</span></code></pre></div></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 3
   combination set   in_comb
   &lt;fct&gt;       &lt;fct&gt;   &lt;dbl&gt;
 1 111         EWR         1
 2 111         LGA         1
 3 111         JFK         1
 4 110         EWR         1
 5 110         LGA         1
 6 110         JFK         0
 7 101         EWR         1
 8 101         LGA         0
 9 101         JFK         1
10 011         EWR         0
# ℹ 11 more rows</code></pre>
</div>
</div>
</section>
<section id="plotting" class="level2">
<h2 class="anchored" data-anchor-id="plotting">Plotting</h2>
<p>Now that the data is in shape, we can start creating the components of the UpSet plot. We will set and slightly modify a global ggplot2 theme that will be applied to all plots in this document. We will also define colours and other plotting parameters as variables for consistency across the individual panels of the UpSet plot.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set global ggplot2 theme</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_light</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>))</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update some theme components specifically for UpSet plots</span></span>
<span id="cb8-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_update</span>(</span>
<span id="cb8-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">l =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb8-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.border =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb8-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb8-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span></span>
<span id="cb8-10">)</span>
<span id="cb8-11"></span>
<span id="cb8-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assign colors from the Okabe-Ito palette to airports</span></span>
<span id="cb8-13">clrs_airports <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">palette.colors</span>()[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(airports)</span>
<span id="cb8-14"></span>
<span id="cb8-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define further plotting parameters for consistency between plots</span></span>
<span id="cb8-16">greys <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey95"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey75"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey50"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey25"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey5"</span>)</span>
<span id="cb8-17">clr_dark <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> greys[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]</span>
<span id="cb8-18">clr_bg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> greys[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb8-19">clr_light <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> greys[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb8-20">pnt_size <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span></span>
<span id="cb8-21">line_width <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span></span>
<span id="cb8-22">ms <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># margin size</span></span>
<span id="cb8-23"></span>
<span id="cb8-24">num_sets <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat_comb_w <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(set) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>()</span>
<span id="cb8-25">clrs_bg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep_len</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(clr_bg, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ceiling</span>(num_sets <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div></div>
</div>
<p>First, we will plot the central matrix which encodes presence/absence of airports in each combination. We use <code>geom_raster()</code> for the alternating background colour of rows. Two separate calls to <code>geom_point()</code> are used to show presence (dark grey) and absence (light-grey). <code>geom_lines()</code> is used to connect presence dots to further highlight combinations. Further modifications are also made to the theme of this panel.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">plot_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat_comb_w <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(in_comb <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> combination, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_rev</span>(set), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> combination)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_raster</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat_comb_w, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_rev</span>(set))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat_comb_w, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> pnt_size, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> clr_light) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> pnt_size, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> clr_dark) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> line_width, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> clr_dark) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> clrs_bg) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb9-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>),</span>
<span id="cb9-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb9-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span></span>
<span id="cb9-16">  )</span>
<span id="cb9-17">plot_matrix</span></code></pre></div></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.gl-eb.me/blog/posts/2025-11-02_upset/index_files/figure-html/plot-combination-matrix-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Next, we plot the number of aircraft types in each combination using <code>geom_col()</code>. To differentiate combinations with different numbers of airports in them (the degree of each combination), we will colour the bars accordingly and sort them by descending combination degree and size.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">plot_comb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat_comb_size <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(combination, size, degree) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb10-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">degree =</span> degree <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_factor</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_inorder</span>()</span>
<span id="cb10-5">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb10-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> combination,</span>
<span id="cb10-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> size,</span>
<span id="cb10-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> degree</span>
<span id="cb10-10">  )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> clr_dark) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(</span>
<span id="cb10-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_pretty</span>(),</span>
<span id="cb10-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb10-15">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> greys[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Intersection Size"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb10-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> ms, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> ms, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">l =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb10-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb10-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb10-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb10-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb10-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> clr_light)</span>
<span id="cb10-25">  )</span>
<span id="cb10-26"></span>
<span id="cb10-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># display plot with x-axis text</span></span>
<span id="cb10-28">plot_comb <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb10-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(),</span>
<span id="cb10-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>()</span>
<span id="cb10-32">  )</span></code></pre></div></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.gl-eb.me/blog/posts/2025-11-02_upset/index_files/figure-html/plot-combination-sizes-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Finally, we will create a histogram showing the number of aircraft types at each airport. In order to fit this panel to the combination matrix, we reverse the direction of the x-axis and move the y-axis to the right of the plot. We will colour each bar representing one of the airports to differentiate this bar plot from the one showing combination sizes.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">plot_set <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat_present <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(airport) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb11-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">airport =</span> airport <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_factor</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_rev</span>()</span>
<span id="cb11-5">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> airport, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> airport)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orientation =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> clr_dark) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_reverse</span>(</span>
<span id="cb11-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">breaks_pretty</span>(),</span>
<span id="cb11-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb11-12">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> clrs_airports) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Aircraft"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb11-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> ms, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">l =</span> ms, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">unit =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb11-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb11-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb11-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb11-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> clr_light),</span>
<span id="cb11-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb11-22">  )</span>
<span id="cb11-23"></span>
<span id="cb11-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># display plot with y-axis text</span></span>
<span id="cb11-25">plot_set <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb11-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(),</span>
<span id="cb11-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>()</span>
<span id="cb11-29">  )</span></code></pre></div></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.gl-eb.me/blog/posts/2025-11-02_upset/index_files/figure-html/plot-set-sizes-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Last but not least, we combine the panels into a single plot using patchwork.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># combine plots using patchwork</span></span>
<span id="cb12-2">plot_upset <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_spacer</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">free</span>(plot_comb, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"space"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">side =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-4">  plot_set <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-5">  plot_matrix <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_layout</span>(</span>
<span id="cb12-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">heights =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>),</span>
<span id="cb12-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">widths =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb12-9">  )</span></code></pre></div></div>
</div>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.gl-eb.me/blog/posts/2025-11-02_upset/index_files/figure-html/display-upset-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Now that we created an UpSet plot, we can start drawing conclusions from the data. In this case we computed non-distinct combinations, meaning that any particular aircraft type might be in multiple combinations. As you can see, while LaGuardia Airport has the fewest unique aircraft types, it is part of the biggest combination containing 41 types observed at both LaGuardia and Newark Liberty International Airport. The combination including all three airports is smaller at 30 types. We can thus conclude that while John F. Kennedy International Airport shares 30 types with the other two airports, it is the most different airport in terms of aircraft types out of the three analysed here. This conclusion is also supported by the fact that it was the highest number of types that do not occur at other airports at 22 types (though Newark is a close second).</p>



</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body">
<div id="ref-lexUpSetVisualizationIntersecting2014" class="csl-entry">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">A. Lex, N. Gehlenborg, H. Strobelt, R. Vuillemot, H. Pfister, UpSet: Visualization of Intersecting Sets. <em>IEEE Trans. Visual. Comput. Graphics</em> <strong>20</strong>, 1983–1992 (2014). doi: <a href="https://doi.org/10.1109/TVCG.2014.2346248">10.1109/TVCG.2014.2346248</a>.</div>
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>I am very particular when it comes to data visualisation. This does not mean they are not right for you.↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{ebert2025,
  author = {Ebert, Gleb G.},
  title = {UpSet {Plots} in the {Tidyverse}},
  date = {2025-11-02},
  url = {https://www.gl-eb.me/blog/posts/2025-11-02_upset/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-ebert2025" class="csl-entry quarto-appendix-citeas">
<div class="">G.
G. Ebert, UpSet Plots in the Tidyverse (2025). <a href="https://www.gl-eb.me/blog/posts/2025-11-02_upset/">https://www.gl-eb.me/blog/posts/2025-11-02_upset/</a>.</div>
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>data visualisation</category>
  <category>science</category>
  <guid>https://www.gl-eb.me/blog/posts/2025-11-02_upset/</guid>
  <pubDate>Sun, 02 Nov 2025 00:00:00 GMT</pubDate>
  <media:content url="https://www.gl-eb.me/blog/posts/2025-11-02_upset/plot_upset_nycf.png" medium="image" type="image/png" height="120" width="144"/>
</item>
<item>
  <title>Generating Printable Labels</title>
  <dc:creator>Gleb G. Ebert</dc:creator>
  <link>https://www.gl-eb.me/blog/posts/2025-05-25_generate-labels/</link>
  <description><![CDATA[ 






<p>I love microbiology. Bacteria in particular have fascinated me for a long time. If you can imagine some sort of biological function or behaviour, there is a bacterium somewhere that does it.<sup>[<em>citation needed</em>]</sup> There are parts of microbiology that I do not particularly enjoy though. (Micro)biological lab work can be time and resource intensive, particularly when both biological and technical replication are necessary. For example, during my master’s studies in Biology at ETH Zurich, I worked with Cécile Lorrain of Bruce McDonald’s group for a three month rotation project. We screened a large collection of natural isolates of <em>Zymoseptoria tritici</em>, a fungus causing massive crop losses in wheat, for their resistance to a range of abiotic stressors.<sup>1</sup> We had a panel of 117 strains that we tested in multiple replicates against four stressors (and a control treatment), resulting in over 1,200 agar plates. Imagine that after preparing the growth medium and pouring all of these plates, you also need to manually label each one with some identifying information like strain, experimental treatment or the date. At the very least you will want a unique identifier that can be looked up in a table containing meta data. There was an alternative: We had <a href="https://www.avery-zweckform.com/produkt/stark-haftende-papier-etiketten-l7871-20">Avery-Zweckform adhesive labels</a> in stock. A corresponding Word template allowed manually entering label content electronically and the printing it onto the sticker sheets using a standard office printer. Not even wanting to bother with the slightly clunky Word template, I set out to write a script that would output a printable PDF layout when supplied with a list of sample names.</p>
<section id="in-the-beginning-there-was-bash" class="level2">
<h2 class="anchored" data-anchor-id="in-the-beginning-there-was-bash">In the beginning there was Bash</h2>
<p>The first version of the <code>generate-stickers</code> script was conceptually based on a script another lab member had written to generate printable layouts for a different kind of experiment.<sup>2</sup> When executed, it would interactively ask the user for the path to an input <code>txt</code> file containing one sample name per line, perform a few basic checks on the input and then iteratively generate LaTeX code<sup>3</sup> which would generate the printable PDF using <code>pdflatex</code>. I “released” version 1.0 of the script in November 2020 by sharing it with other lab members. Version 1.1 followed the next day, fixing a critical bug. Being my first foray into Bash scripting, it wasn’t anything to write home about, but it did what I needed it to do.</p>
</section>
<section id="python-does-it-better" class="level2">
<h2 class="anchored" data-anchor-id="python-does-it-better">Python does it better</h2>
<p>After a two month break following my rotation project, I came back to do my Master’s thesis with Cécile. This time we were going to run an evolution experiment<sup>4</sup> to investigate the evolvability of fungicide resistance in the same fungal plant pathogen, <em>Zymoseptoria tritici</em>. Being good scientists, we wanted to get generalisable results and thus chose to start the experiment with eight diverse ancestral strains, expose them to five different treatments (low and high doses of two fungicide with different mechanisms of action as well as a control), and replicate every combination three times. This resulted in us culturing 120 populations for 14 cycles, each five days long. In order to be able to recapitulate evolution through sequencing later on, we froze samples from all populations at every second cycle.<sup>5</sup> Over the duration of the experiment (70 days in total), I would need to prepare 840 freezer stocks, which included labelling tubes. Thus I again turned to the <code>generate-stickers</code> script.</p>
<p>Being lazy, I did not even want to type out the 840 sample names. Due to their modular nature ([ancestral strain]-[experimental cycle]-[experimental treatment]-[replicate population], e.g.&nbsp;IPO323-C14-CTRL-1), I set out to assemble them programmatically. Unfortunately, I quickly reached the limits of what (my) Bash (skills) could accomplish and I decided to rewrite the script in Python. In addition to the basic functionality of the Bash script, I added the ability to sequentially assemble sample names as well as print the current month and year<sup>6</sup>. The script would also automatically adjust the font size of a given label if the sample name was too long. Version 2.0 was again “released” in February 2021. While using the script to never have to label anything by hand, I made further improvements and bug fixes over the next months.</p>
<p>I graduated in September 2021 and joined Macarena Toll-Riera’s group, at that time still at ETH Zurich, to do a PhD. With evolution experiments being a central to my research, the script got a lot of use (I have printed thousands of labels over the last 3.5 years). I further expanded it’s abilities, switched to <code>xelatex</code> for UTF-8 support and published it on GitHub starting with version 2.5.0. For example, I added the option to skip a certain amount of stickers on the sheet and allowed the user to control the script’s behaviour through command line arguments. Nevertheless, <code>generate-stickers</code> was always just a script, meaning I’d have to place code and input files in the same folder or pass longer file system paths using command-line arguments.<sup>7</sup></p>
</section>
<section id="packaging" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="packaging">Packaging</h2>
<p>Over the years, I had thought about converting the script to a python package. Since I had never developed a Python package before, I never ended up committing the time since it would be a decent amount of work. Then, earlier this year, the layout generated by the script got messed up. I could never figure out what exactly caused the issue, though I suspect it might have been an update to a TeX package. Having my labelling needs unmet finally provided the push I needed to go back and invest time into taking <code>generate-stickers</code> to the next level. I improved the typesetting of the PDF in LaTeX and how file system paths are handled. On the development side, I used the opportunity of converting the script to a package to learn <a href="https://docs.astral.sh/uv/"><code>uv</code></a> and add some basic unit testing combined with continuous integration on GitHub. I also decided to choose a new name for the package: <code>generate-labels</code> 3.0.0 is now available to install from <a href="https://pypi.org/project/generate-labels/">PyPi</a> and <a href="https://github.com/gl-eb/generate-stickers-AveryL7871">GitHub</a>. Finally, in preparation for this blog post, I created a hex sticker for the package, putting a metaphorical neat little bow around it.</p>



<div class="no-row-height column-margin column-container"><div class="">
<p><img src="https://www.gl-eb.me/blog/posts/2025-05-25_generate-labels/sticker_generate-labels.png" class="img-fluid" alt="A hex sticker with a yellow border as well as white background with light grey, rectangular outlines of labels. The package name generate-labels is written across the sticker."></p>
</div></div></section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Think low and high temperatures, salt stress, etc.↩︎</p></li>
<li id="fn2"><p>You would spray wheat plants with a pathogen, let the infection proceed, then collect leafs, stick them onto these sheets of paper in predefined locations, scan them and then run them through an automated image analysis pipeline.↩︎</p></li>
<li id="fn3"><p>Is that what it’s called? Code?↩︎</p></li>
<li id="fn4"><p>To learn more about these, I highly recommend perusing the long-term evolution experiment’s <a href="https://the-ltee.org/">website</a>↩︎</p></li>
<li id="fn5"><p>Do you see where this is going?↩︎</p></li>
<li id="fn6"><p>Why not the entire date? Who knows↩︎</p></li>
<li id="fn7"><p>I got around this with an alias in my <code>.zshrc</code> file↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{ebert2025,
  author = {Ebert, Gleb G.},
  title = {Generating {Printable} {Labels}},
  date = {2025-05-25},
  url = {https://www.gl-eb.me/blog/posts/2025-05-25_generate-labels/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-ebert2025" class="csl-entry quarto-appendix-citeas">
<div class="">G.
G. Ebert, Generating Printable Labels (2025). <a href="https://www.gl-eb.me/blog/posts/2025-05-25_generate-labels/">https://www.gl-eb.me/blog/posts/2025-05-25_generate-labels/</a>.</div>
</div></div></section></div> ]]></description>
  <category>Python</category>
  <category>package development</category>
  <category>science</category>
  <category>PhD</category>
  <guid>https://www.gl-eb.me/blog/posts/2025-05-25_generate-labels/</guid>
  <pubDate>Sun, 25 May 2025 00:00:00 GMT</pubDate>
  <media:content url="https://www.gl-eb.me/blog/posts/2025-05-25_generate-labels/sticker_generate-labels.png" medium="image" type="image/png" height="165" width="144"/>
</item>
<item>
  <title>Introducing tread</title>
  <dc:creator>Gleb G. Ebert</dc:creator>
  <link>https://www.gl-eb.me/blog/posts/2025-05-17_tread/</link>
  <description><![CDATA[ 






<p>This post is marks two special occasions. This is the first post I’m publishing on my personal website and the topic of the post is my first R package — <a href="https://github.com/gl-eb/tread">tread</a>. While tread has been out in the wild for a while now, this post sat around as an unfinished draft for far too long. The main goal of it is to document the motivation behind tread, how it progressed from a function within a script to a fully fledged R package, and how I use it in my research.</p>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>I am currently doing my PhD in the <a href="https://evomicrobio.ethz.ch/">evolutionary microbiology group</a> at ETH Zurich. As an evolutionary biologist I am often interested in how my bacteria are doing under a particular set of conditions, i.e.&nbsp;what their fitness is. One easy way to assay fitness of bacteria is to measure the optical density (OD) of a culture and using it as a proxy for growth. For example, one might grow bacteria at two different temperatures under otherwise equal conditions for a certain duration and then measure their density. This can be done in a high throughput manner by using a plate reader, which allows measuring multiple samples in a microwell plate.</p>
<p>The particular model of plate reader we use in our group is the Infinite Pro 200, made by the Swiss company Tecan. The device is connected to a Windows machine and is controlled using the i-control software. The generated data is written into an Excel spreadsheet. While Excel spreadsheets are a great way to store data in a human-readable manner, they can pose challenges when one wants to analyse the data in a different environment (e.g.&nbsp;in R or Python).</p>
<p>I needed to regularly measure the fitness of a number of bacterial populations that were part of an evolution experiment. Since I did not want to manually transfer the OD data from Excel into R (e.g.&nbsp;through an intermediary csv file), I wrote a function that would first read the contents of the sheet and then extract the data.</p>
<p>Over time I needed this function in multiple R projects, so I spun it out into a package and so <code>tread</code> was born.</p>
</section>
<section id="parsing-tecan-output" class="level2">
<h2 class="anchored" data-anchor-id="parsing-tecan-output">Parsing Tecan Output</h2>
<div id="fig-tecan-header" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tecan-header-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.gl-eb.me/blog/posts/2025-05-17_tread/tecan_excel_header.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tecan-header-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: The header in Tecan’s Excel spreadsheets is rather extensive. While I am in favour of metadata, the header also complicates data extraction
</figcaption>
</figure>
</div>
<p>At its core the main function, <a href="https://www.gl-eb.me/tread/reference/tparse.html"><code>tread::tparse()</code></a>, is fairly simple:</p>
<ol type="1">
<li><a href="https://readxl.tidyverse.org/reference/read_excel.html"><code>readxl::read_excel()</code></a> is used to load the user-specified sheet from an <code>.xlsx</code> file</li>
<li>The contents of the sheet are then parsed to detect the type of data. This is necessary because each sheet begins with a metadata block (Figure&nbsp;1) and the data is shaped differently depending on whether you measure a single or multiple timepoints and how many measurements per well you take</li>
<li>The data is then wrangled into <a href="https://vita.had.co.nz/papers/tidy-data.html">tidy format</a> and returned to the user <span class="citation" data-cites="wickhamTidyData2014">(<em>1</em>)</span></li>
</ol>
<p>My main use case for <code>tparse()</code> is comes from an evolution experiment I am currently running. The bacterial populations inhabit wells of multiple 48-deep well plates (Figure&nbsp;2). The populations are also separated by buffer wells containing only growth medium.</p>
<div id="fig-plate" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.gl-eb.me/blog/posts/2025-05-17_tread/well_plate.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: The schematic of a 48-well plate as used in my evolution experiment. Blue wells that contain bacterial populations are arranged in a checkerboard pattern with yellow buffer wells containing only growth medium.
</figcaption>
</figure>
</div>
<p>At the end of every cycle I transfer a small volume from all wells of all 48-well plates into a single 96-well plate and measure the OD at a wavelength of 600 nm. I then run my analysis script which imports optical density data of all experimental cycles and performs a number of operations on the resulting data set:</p>
<ul>
<li>The OD values of the buffer wells are checked for outliers. These might indicate an contamination. While most of the time they are easy to spot by eye, I have missed some in the past that the outlier detection flagged</li>
<li>The OD of the evolving populations is put on a scatter plot. I look at it to see any suspiciously high or low values</li>
<li>The time series of OD values for each population is plotted so any longer-term trends can be seen</li>
</ul>
</section>
<section id="segmented-growth-curves" class="level2">
<h2 class="anchored" data-anchor-id="segmented-growth-curves">Segmented Growth Curves</h2>
<p>Another use case came up a few cycles into the evolution experiment. I use growth curves to periodically assess the growth dynamics of the evolving populations. Since our bacterium grows slower than e.g.&nbsp;<em>E. coli</em>, and the evolution experiment is performed in nutrient-limited growth medium, growth curves have to be run for at least 48 hours. While a growth curve is run, other lab members cannot use the plate reader. The only solution is to stop and restart the growth curve. However, this will result in the data being saved into multiple sheets of the same <code>.xlsx</code> file.</p>
<p>When stitching together multiple segments of a growth curve, one has to calculate the time offset between them. This as well as copy-pasting values around Excel are error-prone processes. Thus I set out to develop a function that could automatically merge segments into a single data set. The result of this is <a href="https://www.gl-eb.me/tread/reference/tunite.html"><code>tread::tunite()</code></a>:</p>
<ol type="1">
<li>Each sheet found in a user-supplied <code>.xlsx</code> file is read using <code>tparse()</code></li>
<li>Then the time-offsets between segments are calculted using their starting times and durations</li>
<li>The time for all segments except for the first is adjusted by the total duration and offset of all preceding segments</li>
<li>A single data set in tidy format is returned</li>
</ol>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>I will never know if I have saved the time I have invested into developing tread by not having to manually extract data from Excel sheets (n.b.&nbsp;as of writing I have 579 Tecan-generated <code>.xlsx</code> files to show after 3.5 years of PhD). Nevertheless, the process has been a valuable learning experience and I can only recommend spinning out frequently used functions into packages. In fact, last year I set up <a href="https://github.com/gl-eb/glebrt">another package</a> containing a number of functions I commonly use across projects. I found the second edition of Hadley Wickham and Jennifer Bryan’s book <a href="https://r-pkgs.org/">R Packages</a> to be a fantastic resource in this regard <span class="citation" data-cites="wickhamBryanRPackages2e2023">(<em>2</em>)</span>. Creating your first R package might be a bit overwhelming at first, but I took it slow and let it grew organically as my needs evolved.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body">
<div id="ref-wickhamTidyData2014" class="csl-entry">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">H. Wickham, Tidy Data. <em>Journal of Statistical Software</em> <strong>59</strong>, 1–23 (2014). doi: <a href="https://doi.org/10.18637/jss.v059.i10">10.18637/jss.v059.i10</a>.</div>
</div>
<div id="ref-wickhamBryanRPackages2e2023" class="csl-entry">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">H. Wickham, J. Bryan, <em>R Packages (2e)</em> (O’Reilly Media, Incorporated, Sebastopol, 2nd ed., 2023; <a href="https://r-pkgs.org/">https://r-pkgs.org/</a>). <a href="https://r-pkgs.org/">https://r-pkgs.org/</a>.</div>
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{ebert2025,
  author = {Ebert, Gleb G.},
  title = {Introducing Tread},
  date = {2025-05-17},
  url = {https://www.gl-eb.me/blog/posts/2025-05-17_tread/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-ebert2025" class="csl-entry quarto-appendix-citeas">
<div class="">G.
G. Ebert, Introducing tread (2025). <a href="https://www.gl-eb.me/blog/posts/2025-05-17_tread/">https://www.gl-eb.me/blog/posts/2025-05-17_tread/</a>.</div>
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>package development</category>
  <category>science</category>
  <category>PhD</category>
  <guid>https://www.gl-eb.me/blog/posts/2025-05-17_tread/</guid>
  <pubDate>Sat, 17 May 2025 00:00:00 GMT</pubDate>
  <media:content url="https://www.gl-eb.me/blog/posts/2025-05-17_tread/sticker_tread.png" medium="image" type="image/png" height="166" width="144"/>
</item>
</channel>
</rss>
